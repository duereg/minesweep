<html>
	<head>
		<title>
			Minesweeper
		</title>
		<link rel="stylesheet" href="public/css/bootstrap.min.css" type="text/css">
		<link rel="stylesheet" href="public/css/minesweep.css" type="text/css"> 
	</head>
	<body>
		<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container-fluid">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></a>
					<a class="brand" href="#">Mine Sweeper</a> 
				</div>
			</div>
		</div>
		<div class="container">
			<div class="row">
				<div class="span4" id="divControls">
					<div id="divControls" class="form-horizontal controls">
						<div class="control-group">
							<label class="control-label" >Mines Tagged</label>
							<div class="controls">
								<span class="input-mini uneditable-input" data-bind="text: minesTagged"></span>
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" >Tiles Left</label>
							<div class="controls">
								<span class="input-mini uneditable-input" data-bind="text: tilesLeft"></span> 
							</div>
						</div>
						<div class="control-group" data-bind="css: {error: tooFewColumns() || tooManyColumns() }">
							<label class="control-label" for="txtColumns">Number of Columns</label>
							<div class="controls">
								<input id="txtColumns" name="txtColumns" type="number" class="input-small" data-bind="value: columns, attr: {max: maxColumns}" min="1">
								<span class="help-inline" data-bind="visible: tooFewColumns">You need at least one column.</span>
								<span class="help-inline" data-bind="visible: tooManyColumns">You can have no more than <span data-bind="text: maxColumns"></span> columns.</span>
							</div>
						</div>
						<div class="control-group" data-bind="css: {error: tooFewRows() || tooManyRows()}">
							<label class="control-label" for="txtRows">Number of Rows</label>
							<div class="controls">
								<input id="txtRows" name="txtRows" type="number" class="input-small" data-bind="value: rows, attr: {max: maxRows}" min="1" max=32>
								<span class="help-inline" data-bind="visible: tooFewRows">You need at least one row.</span>
								<span class="help-inline" data-bind="visible: tooManyRows">You can have no more than <span data-bind="text: maxRows"></span> rows.</span>
							</div>
						</div>
						<div class="control-group" data-bind="css: {error: tooManyMines() || tooFewMines()}">
							<label class="control-label" for="txtBombs">Number of Bombs</label>
							<div class="controls">
								<input id="txtBombs" name="txtBombs" type="number" class="input-small" data-bind="value: numMines" min="1">
								<span class="help-inline" data-bind="visible: tooManyMines">You have more mines than tiles.</span>
								<span class="help-inline" data-bind="visible: tooFewMines">You need at least one mine.</span>
							</div>
						</div>
						<div class="control-group center"> 
							<button class="btn" data-bind="click: resetBoard, enabled: gameIsValid, css: {'btn-primary': gameIsValid, disabled: !gameIsValid()}">New Game</button> 
							<button class="btn" data-bind="click: validateGame, enabled: canValidate, css: {disabled: !canValidate(), 'btn-warning': canValidate }">Validate</button>
						</div>
					</div>
				</div>
				<div class="span8">
					<div id="divMinesweepBoard" class="center">
						<table cellpadding="0" cellspacing="0" class="minesweep">
							<tbody data-bind="foreach: tiles">
								<tr data-bind="foreach: $data">
									<td>
										<div class="border" data-bind="visible: isBorder"></div>
										<div class="mine" data-bind="visible: showMine" ></div>
										<div class="value" data-bind="visible: showValue, text: value, style: { color: getValueColor }"></div>
										<div class="flagged" data-bind="visible: isTagged, click: click, event: {contextmenu: tag}" ></div>
										<div class="blank"  data-bind="visible: isBlank, click: click, event: {contextmenu: tag}" ></div>
									</td>
								</tr>
							</tbody> 
						</table>
					</div>
				</div>
			</div> 
			<hr>
			<footer id="ftMessages">
				<div class="alert alert-error" data-bind="visible: failure">
					You did not do so well this time. Maybe next time. 
					<button class="btn" data-bind="click: resetBoard, enabled: gameIsValid, css: {'btn-danger': gameIsValid, disabled: !gameIsValid()}">New Game</button>  
				</div>
				<div class="alert alert-success" data-bind="visible: success">
					Congratulations! You won! 
					<button class="btn" data-bind="click: resetBoard, enabled: gameIsValid, css: {'btn-success': gameIsValid, disabled: !gameIsValid()}">New Game</button>   
				</div>
			</footer>
		</div>
		<script type="text/javascript" src="public/js/knockout-2.1.0.js"></script>
		<script type="text/javascript" src="public/js/amplify.core.min.js"></script>
		<script type="text/javascript" src="lib/define.js"></script>
		<script type="text/javascript" src="lib/require.js"></script>
		<script type="text/javascript" src="lib/board.js"></script>
		<script type="text/javascript" src="lib/builder.js"></script>
		<script type="text/javascript" src="lib/boardBuilder.js"></script>
		<script type="text/javascript" src="lib/tileViewModel.js"></script>
		<script type="text/javascript" src="lib/boardViewModel.js"></script>
		<script type="text/javascript" src="lib/gameViewModel.js"></script> 
		<script type="text/javascript">
			var board = window.minesweep.boardBuilder(8, 8, 10);
			var boardViewModel = new window.minesweep.boardViewModel();

			boardViewModel.import(board);
			var game = new window.minesweep.gameViewModel(board, boardViewModel, 32, 32);

			ko.applyBindings(boardViewModel, document.getElementById('divMinesweepBoard'));  
			ko.applyBindings(game, document.getElementById('divControls'));  
			ko.applyBindings(game, document.getElementById('ftMessages'));  
		</script>
	</body>
</html>